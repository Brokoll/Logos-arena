# Logos Arena 2차 보안 점검 리포트 🛡️ (심층 분석)

1차 점검에서 발견된 치명적 취약점 외에, 서비스의 중장기적인 안정성과 데이터를 보호하기 위해 수정이 필요한 **심층 보안 이슈 3가지**를 추가로 발견했습니다.

---

## 1. 📂 스토리지 업로드 권한 오남용 (Insecure Storage Policies)

### 문제 상황 (`schema_storage.sql:15-17`)
현재 이미지 저장소(`debate-images`)의 정책이 매우 관대합니다.
- **현상**: 로그인한 사용자(`authenticated`)라면 누구나 버킷 내 **아무 경로에나** 파일을 올릴 수 있습니다.
- **위험**: 누군가가 `other_user_id/profile.png`와 같은 비정상적인 경로에 파일을 올리거나, 기존 파일을 덮어쓸 수 있는 위험이 있습니다. (공용 버킷이므로 경로 격리가 필수입니다.)

### 해결책
스토리지 업로드 정책을 수정하여, **오직 자신의 사용자 ID로 시작하는 폴더**에만 파일을 올릴 수 있도록 제한해야 합니다.
```sql
-- 예시: 자신의 ID 폴더에만 업로드 허용
CREATE POLICY "Users can upload to their own folder" ON storage.objects
FOR INSERT WITH CHECK (
  bucket_id = 'debate-images' 
  AND (storage.foldername(name))[1] = auth.uid()::text
);
```

---

## 2. ⏳ 서버 액션 도배 방지(Rate Limiting) 누락

### 문제 상황 (`actions.ts`)
주장 게시(Arguments)에는 1분 쿨타임이 적용되어 있으나, **댓글(Comments)과 좋아요(Likes)**에는 아무런 제한이 없습니다.
- **위험**: 매크로나 봇을 사용하여 수천 개의 댓글을 단시간에 달거나, 좋아요 수를 조작하여 서버에 부하를 주고 데이터 신뢰도를 떨어뜨릴 수 있습니다.
- **해결**: 댓글 작성 시에도 최소 5~10초의 쿨타임을 적용하고, 좋아요 역시 단시간 반복 호출 시 제한하는 로직이 필요합니다.

---

## 3. 💬 상세 에러 메시지 노출 (Information Exposure)

### 문제 상황
서버 액션(`actions.ts`)에서 DB 에러 발생 시 `insertError.message`를 클라이언트에 그대로 반환하는 경우가 많습니다.
- **위험**: `dbError.message`에는 테이블 구조, 컬럼명, 제약 조건명 등 **DB 내부 정보**가 포함될 수 있습니다. 이는 공격자에게 DB 구조를 파악할 수 있는 힌트를 제공하게 됩니다.
- **해결**: 사용자에게는 "저장 중 오류가 발생했습니다"와 같은 일반적인 메시지만 보여주고, 상세 에러는 서버 로그(`console.error`)에만 남겨야 합니다.

---

## 🛡️ 권장 조치 사항
1.  **스토리지 RLS 강화**: 사용자별 폴더 격리 정책 적용.
2.  **공통 Rate Limiter 도입**: 댓글/좋아요에도 쿨타임 적용.
3.  **에러 핸들링 정제**: 클라이언트에는 정제된 에러 메시지만 반환.

이 사항들은 서비스 런칭 전 **서비스의 완성도와 방어력**을 높이기 위해 꼭 검토해주시기 바랍니다! 🦾✨
