# Logos Arena ë³´ì•ˆ ì ê²€ ë¦¬í¬íŠ¸ ðŸ›¡ï¸

í˜„ìž¬ ì‹œìŠ¤í…œì„ ë¶„ì„í•œ ê²°ê³¼, ë°°í¬ ì „ ë°˜ë“œì‹œ í•´ê²°í•´ì•¼ í•  **ì¹˜ëª…ì ì¸ ì·¨ì•½ì  1ê°œ**ì™€ **ê¶Œìž¥ ê°œì„  ì‚¬í•­ 2ê°œ**ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

## ðŸš¨ [ì¹˜ëª…ì ] ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì  (Privilege Escalation)

### ë¬¸ì œ ìƒí™©
í˜„ìž¬ `profiles` í…Œì´ë¸”ì˜ ë³´ì•ˆ ì •ì±…(RLS)ì´ "ë‚´ í”„ë¡œí•„ì´ë©´ ë‚´ê°€ ìˆ˜ì • ê°€ëŠ¥"í•˜ê²Œ ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.
ì´ë¡œ ì¸í•´ ì¼ë°˜ ì‚¬ìš©ìžê°€ ë¸Œë¼ìš°ì € ê°œë°œìž ë„êµ¬(ì½˜ì†”)ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ **ë³¸ì¸ì„ ë°”ë¡œ 'ê´€ë¦¬ìž'ë¡œ ë§Œë“¤ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.**

```javascript
// ê³µê²© ì˜ˆì‹œ (ë¸Œë¼ìš°ì € ì½˜ì†”)
supabase.from('profiles').update({ role: 'admin' }).eq('id', 'ë‚´_ID')
```

### í•´ê²°ì±… (Remediation)
ì‚¬ìš©ìžê°€ ì§ì ‘ ìžì‹ ì˜ `role` ì»¬ëŸ¼ì€ ê±´ë“œë¦¬ì§€ ëª»í•˜ê²Œ DB ì •ì±…ì„ ê°•í™”í•´ì•¼ í•©ë‹ˆë‹¤. 
ì•„ëž˜ SQLì„ ì‹¤í–‰í•˜ë©´ **ê´€ë¦¬ìžë§Œì´ ë‹¤ë¥¸ ì‚¬ìš©ìžì˜ ê¶Œí•œì„ ë°”ê¿€ ìˆ˜ ìžˆê²Œ ë©ë‹ˆë‹¤.**

---

## âš ï¸ [ì¤‘ìš”] ì¢‹ì•„ìš” ì¹´ìš´íŠ¸ ìŒìˆ˜ ì˜¤ë¥˜ (Negative Likes)

### ë¬¸ì œ ìƒí™©
ì‚¬ìš©ìžê°€ "ì¢‹ì•„ìš” ì·¨ì†Œ"ë¥¼ ë¹„ì •ìƒì ìœ¼ë¡œ ë°˜ë³µ í˜¸ì¶œí•  ê²½ìš°, `like_count`ê°€ `0`ë³´ë‹¤ ìž‘ì€ `-1`, `-2` ë“±ìœ¼ë¡œ ë–¨ì–´ì§ˆ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### í•´ê²°ì±…
ë°ì´í„°ë² ì´ìŠ¤ ì°¨ì›ì—ì„œ `like_count`ê°€ 0 ë¯¸ë§Œìœ¼ë¡œ ë–¨ì–´ì§€ì§€ ì•Šê²Œ ì œì•½ ì¡°ê±´ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ðŸ”’ [ê¶Œìž¥] ì´ë¯¸ì§€ ì €ìž¥ì†Œ(Storage) ë³´ì•ˆ ê°•í™”

### ë¬¸ì œ ìƒí™©
í˜„ìž¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œ íŒŒì¼ëª… ì¶©ëŒì´ë‚˜ íƒ€ì¸ì˜ íŒŒì¼ ì‚­ì œ ê°€ëŠ¥ì„±ì´ ì—´ë ¤ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### í•´ê²°ì±…
íŒŒì¼ëª…ì— `UUID`ë¥¼ ê°•ì œí•˜ê³ , ë³¸ì¸ì´ ì˜¬ë¦° íŒŒì¼ë§Œ ì‚­ì œ/ìˆ˜ì •í•  ìˆ˜ ìžˆë„ë¡ ìŠ¤í† ë¦¬ì§€ RLSë¥¼ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

---

# ðŸ› ï¸ ì§€ê¸ˆ ì¦‰ì‹œ ì ìš©í•´ì•¼ í•  ë³´ì•ˆ íŒ¨ì¹˜ (SQL)

ì•„ëž˜ SQLì„ **Supabase SQL Editor**ì—ì„œ ì‹¤í–‰í•´ ì£¼ì„¸ìš”. ê°€ìž¥ ì¹˜ëª…ì ì¸ **ê´€ë¦¬ìž ê¶Œí•œ íƒˆì·¨**ë¥¼ ë§‰ì•„ì¤ë‹ˆë‹¤.

```sql
-- 1. profiles í…Œì´ë¸”ì˜ ê¸°ì¡´ UPDATE ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Users can update own profile" ON public.profiles;

-- 2. ìƒˆë¡œìš´ ì•ˆì „í•œ UPDATE ì •ì±… ì¶”ê°€ (usernameë§Œ ìˆ˜ì • ê°€ëŠ¥í•˜ê²Œ ì œí•œí•˜ê±°ë‚˜, role ë³€ê²½ ê°ì§€ ì‹œ ì°¨ë‹¨)
-- ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœí™”ë¥¼ ìœ„í•´ roleì´ 'admin'ìœ¼ë¡œì˜ ë³€ê²½ì€ ì˜¤ì§ ê¸°ì¡´ ì–´ë“œë¯¼ë§Œ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •í•˜ê±°ë‚˜ 
-- ì¼ë°˜ ì‚¬ìš©ìžëŠ” ë³¸ì¸ì˜ ë‹¤ë¥¸ ì •ë³´(username ë“±)ë§Œ ìˆ˜ì •í•˜ë„ë¡ í•©ë‹ˆë‹¤.
CREATE POLICY "Users can update own basic profile" ON public.profiles
  FOR UPDATE USING (auth.uid() = id)
  WITH CHECK (
    -- role ì»¬ëŸ¼ì´ ë°”ë€Œì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì€ ë³µìž¡í•˜ë¯€ë¡œ, 
    -- 'user' ì—­í• ì¸ ì‚¬ëžŒë§Œ ë³¸ì¸ ì •ë³´ë¥¼ ìˆ˜ì • ê°€ëŠ¥í•˜ê²Œ í•˜ë˜, 
    -- roleì„ 'admin'ìœ¼ë¡œ ë°”ê¾¸ë ¤ëŠ” ì‹œë„ëŠ” ì°¨ë‹¨í•©ë‹ˆë‹¤.
    (SELECT role FROM public.profiles WHERE id = auth.uid()) = 'user' 
    AND role = 'user' -- ë³¸ì¸ì´ userë¼ë©´ ê³„ì† userë¡œë§Œ ì €ìž¥ ê°€ëŠ¥
    OR 
    (SELECT role FROM public.profiles WHERE id = auth.uid()) = 'admin' -- ì–´ë“œë¯¼ì€ ìžìœ ë¡­ê²Œ ìˆ˜ì • ê°€ëŠ¥
  );

-- 3. ì¢‹ì•„ìš” ìŒìˆ˜ ë°©ì§€ ì œì•½ ì¡°ê±´ ì¶”ê°€
ALTER TABLE public.arguments ADD CONSTRAINT like_count_non_negative CHECK (like_count >= 0);
ALTER TABLE public.comments ADD CONSTRAINT like_count_non_negative CHECK (like_count >= 0);
ALTER TABLE public.notices ADD CONSTRAINT like_count_non_negative CHECK (like_count >= 0);
```
